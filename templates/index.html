<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BC3415 App</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{url_for('static',filename='styles.css')}}"
    />
    <script
      type="module"
      src="{{ url_for('static', filename='script.js') }}"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Landing Page -->
    <div class="landing-page">
      <h1>WealthWise</h1>

      <!-- Logo under the title -->
      <p class="tagline">Your path to smarter savings and better planning</p>
      <img
        src="{{ url_for('static', filename='assets/wealthwise-logo.png') }}"
        alt="WealthWise Logo"
        style="width: 400px; height: auto"
      />

      <div class="button-container">
        <button onclick="scrollToSection('character-section')">
          Create Your Character
        </button>
        <button onclick="scrollToSection('record-section')">
          Enter Your Expenses
        </button>
        <button onclick="scrollToSection('saving-section')">
          Savings Recommendations
        </button>
        <button onclick="scrollToSection('planning-section')">
          Financial Strategy
        </button>
      </div>
    </div>

  <!-- Create Your Character Section -->
  <section id="character-section", class = "section">
    <h2>Create your character!</h2>
    <div id="character-result"style="margin-bottom: 20px;"></div>
    <input type="text" id="character-prompt" placeholder="Describe your character here" />
    <button id="generate-character">Generate Character</button>
    <button id="feeling-lucky">I'm feeling lucky!</button>
  </section>

    <!-- Section 1: Record Expense or Deposits -->
    <section id="record-section" class="section">
      <h2>Record Expenses or Deposits</h2>
      <form id="expense-form">
        <label for="name">Name:</label>
        <input type="text" id="name" required />

        <label for="type">Inflow/Outflow:</label>
        <select id="type" required>
          <option value="Debit">Outflow</option>
          <option value="Credit">Inflow</option>
        </select>

        <div id="category-field" style="display: none">
          <label for="category">Category:</label>
          <select id="category">
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Rent">Rent</option>
            <option value="Entertainment">Entertainment</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <label for="amount">Amount:</label>
        <input type="number" id="amount" required />

        <button type="submit">Submit</button>
      </form>

      <!-- Historical Expenses Table -->
      <div id="history">
        <h3>Historical Expenses</h3>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Category</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody id="history-table-body">
            <!-- Dynamic Content -->
          </tbody>
        </table>
      </div>
    </section>

    <!-- Section 2: Saving Strategy -->
    <section id="saving-section" class="section">
      <h2>Saving Strategy</h2>

      <canvas id="spendingChart" width="400" height="400"></canvas>

      <button id="generate-savings">Generate Savings Strategy</button>
      <div id="savings-result">
        {% if savings_strategy %}
        <p>{{ savings_strategy | safe}}</p>
        {% endif %}
      </div>
      <script>
        // AJAX form submission
        document
          .getElementById("generate-savings")
          .addEventListener("click", function () {
            event.preventDefault(); // Prevent the default form submission
            const formData = new FormData(this);

            // AJAX request using fetch API
            fetch("/generate_savings_strategy", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json()) // Parse the response as JSON
              .then((data) => {
                // Update the result slide with the financial plan text
                document.getElementById(
                  "savings-result"
                ).innerHTML = `<p>${data.savings_strategy}</p>`;
              })
              .catch((error) => console.error("Error:", error));
          });
      </script>
    </section>

    <!-- Section 3: Financial Planning -->
    <!--
    <section id="planning-section" class="section">
      <h2>Financial Planning</h2>

      <form action="/generate_financial_plan#planning-section" method="POST">
        <!- - Goal Textbox - ->
        <label for="goal">Your Financial Goal:</label>
        <textarea id="goal" name="goal" rows="4" required></textarea>
      
        <!- - Time Horizon Slider - ->
        <label for="time_horizon">Time Horizon (Years):</label>
        <input
          type="range"
          id="time_horizon"
          name="time_horizon"
          min="1"
          max="30"
          value="5"
          oninput="document.getElementById('time_value').innerText = this.value"
        />
        <span id="time_value">5</span> years
      
        <!- - Risk Appetite Slider - ->
        <label for="risk_appetite">Risk Appetite:</label>
        <input
          type="range"
          id="risk_appetite"
          name="risk_appetite"
          min="0"
          max="100"
          value="50"
          oninput="document.getElementById('risk_value').innerText = this.value"
        />
        <span id="risk_value">50</span>% Risk
      
        <button type="submit">Generate Plan</button>
      </form>
      <div id="planning_result">
        {% if financial_plan %}
          <p>{{ financial_plan | safe}}</p>
        {% endif %}
      </div>
    </section>
    -->
    <section id="planning-section" class="section">
      <h2>Financial Planning</h2>

      <div class="carousel-wrapper">
        <div class="carousel-container">
          <!-- Slide 1: Input Form -->
          <div class="carousel-slide" id="form-slide">
            <form id="financial-plan-form">
              <label for="goal">Your Financial Goal:</label>
              <textarea id="goal" name="goal" rows="4" required></textarea>
              <label for="time_horizon">Time Horizon (Years):</label>
              <input
                type="range"
                id="time_horizon"
                name="time_horizon"
                min="1"
                max="30"
                value="5"
                oninput="document.getElementById('time_value').innerText = this.value"
              />
              <span id="time_value">5</span> years

              <label for="risk_appetite">Risk Appetite:</label>
              <input
                type="range"
                id="risk_appetite"
                name="risk_appetite"
                min="0"
                max="100"
                value="50"
                oninput="document.getElementById('risk_value').innerText = this.value"
              />
              <span id="risk_value">50</span>% Risk
              <button type="submit">Generate Plan</button>
            </form>
          </div>

          <!-- Slide 2: Display Financial Plan with Loading Spinner -->
          <div class="carousel-slide" id="result-slide">
            <div id="planning_result">
              <div
                class="spinner"
                id="loading-spinner"
                style="display: none"
              ></div>
              <p>Your financial plan will appear here once generated.</p>
            </div>
          </div>
        </div>

        <!-- Navigation Arrows -->
        <button class="carousel-arrow left-arrow" onclick="moveSlide(-1)">
          &#10094;
        </button>
        <button class="carousel-arrow right-arrow" onclick="moveSlide(1)">
          &#10095;
        </button>

        <!-- Page Indicator Dots -->
        <div class="carousel-dots">
          <span class="dot" onclick="showSlide(0)"></span>
          <span class="dot" onclick="showSlide(1)"></span>
        </div>
      </div>
    </section>

    <style>
      .carousel-wrapper {
        position: relative;
        overflow: hidden;
        max-width: 100%; /* Full width on smaller screens */
        margin: auto;
        padding: 0 10px;
      }

      .carousel-container {
        display: flex;
        transition: transform 0.5s ease-in-out;
      }

      .carousel-slide {
        min-width: 100%;
        flex-shrink: 0;
        box-sizing: border-box;
        padding: 10px;
        text-align: left;
        overflow-wrap: break-word;
        max-width: 600px; /* Restrict slide width for better fit */
        margin: auto;
      }

      /* Responsive font size */
      .carousel-slide p,
      .carousel-slide span {
        font-size: 1em;
      }

      /* Adjust font size for smaller screens */
      @media (max-width: 600px) {
        .carousel-slide p,
        .carousel-slide span {
          font-size: 0.9em;
        }
      }

      /* Arrow Styling */
      .carousel-arrow {
        position: absolute;
        top: 50%;
        font-size: 24px;
        cursor: pointer;
        background: none;
        border: none;
        color: #333;
        transform: translateY(-50%);
        z-index: 10;
      }

      .left-arrow {
        left: 10px;
      }

      .right-arrow {
        right: 10px;
      }

      .carousel-dots {
        display: flex;
        justify-content: center;
        margin-top: 10px;
      }

      .dot {
        height: 10px;
        width: 10px;
        margin: 0 4px;
        background-color: #bbb;
        border-radius: 50%;
        display: inline-block;
        cursor: pointer;
      }

      .dot.active {
        background-color: #333;
      }

      /* Spinner styling */
      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #333;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>

    <script>
      let currentSlide = 0;

      // Touch event variables
      let startX = 0;
      let endX = 0;

      // Add touch event listeners to detect swipe
      const carouselContainer = document.querySelector(".carousel-container");
      carouselContainer.addEventListener("touchstart", handleTouchStart, false);
      carouselContainer.addEventListener("touchend", handleTouchEnd, false);

      function handleTouchStart(event) {
        startX = event.touches[0].clientX;
      }

      function handleTouchEnd(event) {
        endX = event.changedTouches[0].clientX;
        handleSwipe();
      }

      function handleSwipe() {
        const swipeThreshold = 50; // Minimum distance for a swipe to be considered

        if (startX - endX > swipeThreshold) {
          // Swipe left
          moveSlide(1);
        } else if (endX - startX > swipeThreshold) {
          // Swipe right
          moveSlide(-1);
        }
      }

      function moveSlide(direction) {
        const slides = document.querySelectorAll(".carousel-slide");
        currentSlide =
          (currentSlide + direction + slides.length) % slides.length;
        showSlide(currentSlide);
      }

      function showSlide(index) {
        currentSlide = index;
        const carousel = document.querySelector(".carousel-container");
        carousel.style.transform = `translateX(-${index * 100}%)`;
        updateDots();
      }

      function updateDots() {
        const dots = document.querySelectorAll(".dot");
        dots.forEach((dot) => dot.classList.remove("active"));
        dots[currentSlide].classList.add("active");
      }

      // AJAX form submission
      document
        .getElementById("financial-plan-form")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the default form submission

          const formData = new FormData(this);

          // Show the loading spinner and move to the result slide
          document.getElementById("loading-spinner").style.display = "block";
          showSlide(1);

          // AJAX request using fetch API
          fetch("/generate_financial_plan", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json()) // Parse the response as JSON
            .then((data) => {
              // Hide the loading spinner
              document.getElementById("loading-spinner").style.display = "none";
              // Update the result slide with the financial plan text
              document.getElementById(
                "planning_result"
              ).innerHTML = `<p>${data.financial_plan}</p>`;
            })
            .catch((error) => {
              document.getElementById("loading-spinner").style.display = "none";
              document.getElementById("planning_result").innerHTML =
                "<p>Error: Could not generate the financial plan.</p>";
              console.error("Error:", error);
            });
        });

      document.addEventListener("DOMContentLoaded", () => {
        showSlide(0); // Show the first slide on load
      });
    </script>
  </body>
</html>

